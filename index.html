<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aurum</title>
  <link rel="icon" type="image/png" href="img/logo.png" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar__header">
        <div>
          <img src="img/logo.png" alt="Aurum" class="sidebar__logo" />
          <h1>Aurum</h1>
          <p>Investor Dashboard</p>
        </div>
        <button class="icon-btn sidebar__close" id="closeSidebar">X</button>
      </div>
      <button class="btn btn--primary" id="newPortfolioBtn">+ Nueva cartera</button>
      <nav class="sidebar__nav">
        <button class="nav__item" data-view="dashboard">
          <span>Inicio / Dashboard</span>
        </button>
        <div class="nav__label">Carteras</div>
        <div id="portfolioList" class="nav__list"></div>
      </nav>
      <div class="sidebar__footer">
        <button class="btn btn--ghost" id="renamePortfolioBtn">Renombrar cartera</button>
        <button class="btn btn--danger" id="deletePortfolioBtn">Eliminar cartera</button>
      </div>
    </aside>

    <div class="content">
      <header class="topbar">
        <button class="icon-btn" id="toggleSidebar">Menu</button>
        <div>
          <h2 id="viewTitle">Dashboard</h2>
          <p id="viewSubtitle">Resumen global</p>
        </div>
        <button class="icon-btn" id="settingsBtn">âš™</button>
      </header>

      <main id="mainContent">
        <section id="dashboardView" class="view active">
          <div class="kpi-grid" id="dashboardKpis"></div>

          <section class="card">
            <div class="card__header">
              <h3>Resumen por cartera</h3>
            </div>
            <div class="table-wrapper">
              <table class="table" id="summaryTable">
                <thead>
                  <tr>
                    <th>Cartera</th>
                    <th>Aportes netos</th>
                    <th>Valor actual</th>
                    <th>Ganancias totales</th>
                    <th>Ultima actualizacion</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>

          <div class="chart-grid">
            <section class="card card--chart">
              <div class="card__header">
                <h3>Evolucion total</h3>
                <div class="segmented" id="dashboardChartMode">
                  <button data-mode="cumulative" class="active">Ganancia acumulada</button>
                  <button data-mode="gain">Ganancia diaria</button>
                  <button data-mode="balance">Balance total</button>
                </div>
              </div>
              <canvas id="lineChart" height="220"></canvas>
            </section>
            <section class="card card--chart">
              <div class="card__header">
                <h3>Distribucion por cartera</h3>
              </div>
              <canvas id="doughnutChart" height="220"></canvas>
            </section>
          </div>
        </section>

        <section id="portfolioView" class="view">
          <div class="portfolio-header">
            <div>
              <h3 id="portfolioName">Cartera</h3>
              <p class="muted">Detalle y movimientos</p>
            </div>
          </div>

          <div class="kpi-grid" id="portfolioKpis"></div>
          <div class="widgets-header">
            <h4>Widgets personalizados</h4>
            <button class="btn btn--ghost" id="addWidgetBtn">Agregar widget</button>
          </div>
          <div class="widget-grid" id="customWidgets"></div>

          <section class="card card--chart">
            <div class="card__header">
              <h3>Evolucion diaria</h3>
              <div class="segmented" id="chartMode">
                <button data-mode="cumulative" class="active">Ganancia acumulada</button>
                <button data-mode="gain">Ganancia diaria</button>
                <button data-mode="balance">Balance total</button>
              </div>
              <button class="btn btn--primary" id="addBalanceBtn">Agregar balance diario</button>
            </div>
            <canvas id="portfolioLineChart" height="220"></canvas>
          </section>

          <div class="details-bar">
            <h4>Detalles y movimientos</h4>
            <div class="segmented" id="rangeFilters">
              <button data-range="7d">7d</button>
              <button data-range="30d" class="active">30d</button>
              <button data-range="ytd">YTD</button>
              <button data-range="all">Todo</button>
            </div>
          </div>

          <section class="card">
            <div class="card__header">
              <h3>Registros de balance</h3>
            </div>
            <div class="table-wrapper">
              <table class="table" id="balancesTable">
                <thead>
                  <tr>
                    <th class="sortable" data-sort="date">Fecha</th>
                    <th class="sortable" data-sort="value">Balance (CLP)</th>
                    <th class="sortable" data-sort="dailyGain">Ganancia diaria</th>
                    <th class="sortable" data-sort="dailyPercent">% diario</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="pagination">
              <span id="balancesInfo" class="muted"></span>
              <div class="pagination__controls">
                <button class="btn btn--ghost" id="balancesPrev">Anterior</button>
                <button class="btn btn--ghost" id="balancesNext">Siguiente</button>
              </div>
            </div>
          </section>

          <section class="card">
            <div class="card__header">
              <h3>Movimientos</h3>
              <div class="filters">
                <select id="typeFilter">
                  <option value="all">Todos los tipos</option>
                  <option value="aporte">Aporte</option>
                  <option value="retiro">Retiro</option>
                  <option value="compra">Compra</option>
                  <option value="venta">Venta</option>
                  <option value="comision">Comision</option>
                </select>
                <input type="number" id="amountMin" min="0" placeholder="Min CLP" />
                <input type="number" id="amountMax" min="0" placeholder="Max CLP" />
                <input type="text" id="searchInput" placeholder="Buscar por nota, tipo o fecha" />
              </div>
              <button class="btn btn--primary" id="addMovementBtn">Agregar movimiento</button>
            </div>
            <div class="table-wrapper">
              <table class="table" id="transactionsTable">
                <thead>
                  <tr>
                    <th class="sortable" data-sort="date">Fecha</th>
                    <th class="sortable" data-sort="type">Tipo</th>
                    <th class="sortable" data-sort="amount">Monto</th>
                    <th class="sortable" data-sort="note">Nota</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>
        </section>
      </main>
    </div>
  </div>

  <div class="modal" id="movementModal">
    <div class="modal__content">
      <div class="modal__header">
        <h3 id="modalTitle">Agregar movimiento</h3>
        <button class="icon-btn" id="closeModal">X</button>
      </div>
      <form id="movementForm">
        <input type="hidden" id="transactionId" />
        <label>
          Fecha
          <input type="date" id="dateInput" required />
        </label>
        <label>
          Tipo
          <select id="typeInput">
            <option value="aporte">Aporte</option>
            <option value="retiro">Retiro</option>
            <option value="compra">Compra</option>
            <option value="venta">Venta</option>
            <option value="comision">Comision</option>
          </select>
        </label>
        <label>
          Monto (CLP)
          <input type="number" id="amountInput" min="0" required />
        </label>
        <label>
          Nota
          <textarea id="noteInput" rows="3"></textarea>
        </label>
        <div class="modal__actions">
          <button type="button" class="btn btn--ghost" id="cancelModal">Cancelar</button>
          <button type="submit" class="btn btn--primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal" id="portfolioModal">
    <div class="modal__content">
      <div class="modal__header">
        <h3 id="portfolioModalTitle">Nueva cartera</h3>
        <button class="icon-btn" id="closePortfolioModal">X</button>
      </div>
      <form id="portfolioForm">
        <label>
          Nombre de cartera
          <input type="text" id="portfolioNameInput" required />
        </label>
        <label>
          Moneda
          <select id="portfolioCurrencyInput">
            <option value="CLP">CLP</option>
            <option value="USD">USD</option>
          </select>
        </label>
        <label id="portfolioUsdRateField">
          Valor USD en CLP
          <input type="number" id="portfolioUsdRateInput" min="1" step="0.01" placeholder="Ej: 900" />
        </label>
        <label>
          Color representativo
          <input type="color" id="portfolioColorInput" value="#22c55e" />
        </label>
        <div class="modal__actions">
          <button type="button" class="btn btn--ghost" id="cancelPortfolio">Cancelar</button>
          <button type="submit" class="btn btn--primary" id="portfolioSubmitBtn">Crear</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal" id="balanceModal">
    <div class="modal__content">
      <div class="modal__header">
        <h3 id="balanceModalTitle">Agregar balance diario</h3>
        <button class="icon-btn" id="closeBalanceModal">X</button>
      </div>
      <form id="balanceForm">
        <input type="hidden" id="balanceId" />
        <label>
          Fecha
          <input type="date" id="balanceDateInput" required />
        </label>
        <label>
          Balance total (CLP)
          <input type="number" id="balanceValueInput" min="0" required />
        </label>
        <div class="modal__actions">
          <button type="button" class="btn btn--ghost" id="cancelBalance">Cancelar</button>
          <button type="submit" class="btn btn--primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal" id="settingsModal">
    <div class="modal__content">
      <div class="modal__header">
        <h3>Configuracion</h3>
        <button class="icon-btn" id="closeSettingsModal">X</button>
      </div>
      <div class="settings-list">
        <button class="btn btn--ghost" id="exportBtn">Exportar JSON</button>
        <label class="btn btn--ghost file-input">
          Importar JSON
          <input type="file" id="importInput" accept="application/json" />
        </label>
        <div class="settings-group settings-group--compact">
          <div class="settings-title">Colores del dashboard</div>
          <label class="settings-field">
            <span>Positivos</span>
            <input type="color" id="positiveColorInput" value="#22c55e" />
          </label>
          <label class="settings-field">
            <span>Negativos</span>
            <input type="color" id="negativeColorInput" value="#ef4444" />
          </label>
          <label class="settings-field">
            <span>Graficos</span>
            <input type="color" id="chartColorInput" value="#22c55e" />
          </label>
        </div>
        <div class="settings-group">
          <div class="settings-title">Privacidad</div>
          <label class="settings-toggle">
            <input type="checkbox" id="presentationToggle" />
            <span>Modo presentacion</span>
          </label>
        </div>
        <button class="btn btn--primary" id="doneSettingsBtn">Hecho</button>
        <button class="btn btn--danger" id="resetBtn">Resetear datos</button>
      </div>
    </div>
  </div>

  <div class="modal" id="widgetModal">
    <div class="modal__content">
      <div class="modal__header">
        <h3>Agregar widget</h3>
        <button class="icon-btn" id="closeWidgetModal">X</button>
      </div>
      <form id="widgetForm">
        <label>
          Tipo de widget
          <select id="widgetType" required>
            <option value="last30Gain">Ultimos 30 dias</option>
            <option value="avgDailyValue">Promedio diario numerico</option>
            <option value="bestDay">Mejor dia</option>
            <option value="worstDay">Peor dia</option>
            <option value="streakCurrent">Racha actual</option>
            <option value="maxStreakPositive">Maxima racha historica</option>
          </select>
        </label>
        <div class="modal__actions">
          <button type="button" class="btn btn--ghost" id="cancelWidget">Cancelar</button>
          <button type="submit" class="btn btn--primary">Agregar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <span id="toastMessage"></span>
    <button class="btn btn--ghost" id="toastUndoBtn">Deshacer</button>
  </div>

  <script src="app.js"></script>
</body>
</html>
